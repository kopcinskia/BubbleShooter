(function(jQuery){let defaults={gravity:1.3,maxY:800}
let toMove=[]
let prevTime
jQuery.fn.kaboom=function(settings){let config=$.extend({},defaults,settings)
if(toMove.length==0){prevTime=Date.now()
requestAnimationFrame(moveAll)}let dx=Math.round(Math.random()*14)-7,dy=Math.round(Math.random()*7)+7
toMove.push({elm:this,dx:dx,dy:dy,x:this.position().left,y:this.position().top,config:config})}
let moveAll=function(){let newTime=Date.now(),elapsed=newTime-prevTime,frameProportion=elapsed/25
prevTime=newTime
let stillToMove=[]
for(let i=0;i<toMove.length;i++){let obj=toMove[i]
obj.x+=obj.dx*frameProportion
obj.y-=obj.dy*frameProportion
obj.dy-=obj.config.gravity*frameProportion
if(obj.y<obj.config.maxY){obj.elm.css({top:Math.round(obj.y),left:Math.round(obj.x)})
stillToMove.push(obj)}else if(obj.config.callback){obj.config.callback()}}toMove=stillToMove
if(toMove.length>0)requestAnimationFrame(moveAll)}})(jQuery)